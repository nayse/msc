import androidx.test.ext.junit.runners.AndroidJUnit4;
import androidx.test.rule.ActivityTestRule;

import org.junit.Rule;
import org.junit.Test;
import org.junit.runner.RunWith;

import static androidx.test.espresso.Espresso.onView;
import static androidx.test.espresso.action.ViewActions.*;
import static androidx.test.espresso.assertion.ViewAssertions.matches;
import static androidx.test.espresso.matcher.ViewMatchers.*;

@RunWith(AndroidJUnit4.class)
public class MainScreenCoreTest {

    @Rule
    public ActivityTestRule<MainActivity> activityRule =
            new ActivityTestRule<>(MainActivity.class);

    @Test
    public void testCoreFunctionality() {
        // 1. Buscar por um item
        onView(withText("Find"))
                .perform(click(), typeText("Test Book"), closeSoftKeyboard());

        // 2. Verificar se contador de resultados atualiza (não vazio)
        onView(withId(R.id.countBooks))
                .check(matches(not(withText("0"))));

        // 3. Alterar critério de ordenação
        onView(withText("Date"))
                .perform(click());
        // (Aqui assumimos que aparece uma lista com outras opções, ex: "Title")
        onView(withText("Title")).perform(click());

        // 4. Trocar ordem de ordenação (asc/desc)
        onView(withId(R.id.sortOrder))
                .perform(click());

        // 5. Alternar entre lista e grade
        onView(withId(R.id.onGridList))
                .perform(click());
        // Verifica que recyclerView está visível
        onView(withId(R.id.recyclerView))
                .check(matches(isDisplayed()));
    }
}
